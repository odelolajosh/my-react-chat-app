(this["webpackJsonpreact-chat-app"]=this["webpackJsonpreact-chat-app"]||[]).push([[0],[,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"e",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"f",(function(){return s}));var r="login_user_failed",a="login_user_pending",o="login_user_success",c="logout_user_pending",u="logout_user_failed",s="logout_user_success"},function(e,t,n){"use strict";var r=n(10);t.a=new function e(){var t=this;Object(r.a)(this,e),this.USER_TOKEN_KEY="user_token_key",this.USER_ID_KEY="user_id_key",this.getAuthValue=function(){return{token:window.localStorage.getItem(t.USER_TOKEN_KEY),userId:window.localStorage.getItem(t.USER_ID_KEY)}},this.isAuthenticated=function(){return Boolean(window.localStorage.getItem(t.USER_TOKEN_KEY))},this.authenticate=function(e,n,r){if(window.localStorage.setItem(t.USER_TOKEN_KEY,n),window.localStorage.setItem(t.USER_ID_KEY,e),r&&"function"===typeof r)return r()},this.unauthenticate=function(e){window.localStorage.clear(),e&&"function"===typeof e&&e()}}},,,,,,,,,,function(e,t,n){"use strict";var r=n(10),a=n(16),o=n(19),c=n(18),u=n(0),s=n.n(u),i=n(1),l={errorColor:"var(--base-red)",warningColor:"var(--base-orange)"},m={backgroundColor:"var(--light-background)",contrastColor:"var(--light-contrast-neutral)",contrastColorMid:"var(--base-light-contrast-mid)",contrastColorFade:"var(--base-light-contrast-fade)",contrastColorFall:"var(--base-light-contrast-fall)",textColor:"var(--text-black)",textContrastColor:"var(--text-black-contrast)"},h={backgroundColor:"var(--dark-background)",contrastColor:"var(--dark-contrast-neutral)",contrastColorMid:"var(--base-dark-contrast-mid)",contrastColorFade:"var(--base-dark-contrast-fade)",contrastColorFall:"var(--base-dark-contrast-fall)",textColor:"var(--text-white)",textContrastColor:"var(--text-white-contrast)"},p=s.a.createContext(),E=function(e){Object(o.a)(n,e);var t=Object(c.a)(n);function n(){var e;Object(r.a)(this,n);for(var a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];return(e=t.call.apply(t,[this].concat(o))).state={theme:"night"},e.toggleTheme=function(){e.setState((function(e){var t="day"===e.theme?"night":"day";return window.localStorage.setItem("USER_THEME_PREFERENCE",t),console.log("toggle "+e.theme+" ",t),{theme:"day"}}))},e}return Object(a.a)(n,[{key:"render",value:function(){return s.a.createElement(p.Provider,{value:{theme:(e=this.state.theme,Object(i.a)(Object(i.a)({primaryColor:"var(--base-color)",secondaryColor:"var(--base-color-dark)"},l),"day"===e?Object(i.a)({},m):Object(i.a)({},h))),state:this.state.theme,toggleTheme:this.toggleTheme}},this.props.children);var e}}]),n}(u.Component);E.getDerivedStateFromProps=function(){var e=window.localStorage.getItem("USER_THEME_PREFERENCE");return e?{theme:e}:(window.localStorage.setItem("USER_THEME_PREFERENCE","night"),null)};var f={Provider:E,Consumer:p.Consumer,MyThemeContext:p};t.a=f},,,function(e,t,n){"use strict";var r=n(4),a=n.n(r),o=n(15),c=n(1),u=n(10),s=n(6),i=function(){return{type:s.b}},l=function(e){return{type:s.c,payload:e}},m=function(e){return{type:s.a,payload:e}},h=n(7),p=n(16),E=new(function(){function e(){Object(u.a)(this,e),this.FAILED_TO_FETCH="failed to fetch",this.AN_ERROR_OCCURRED="an error occurred",this.POOR_INTERNET_CONNECTION="poor internet connection",this.UNAUTHENTICATED_USER="you have to login",this.USER_NOT_FOUND="user not found",this.checkErrorBool=function(e){return e&&null!==e.message}}return Object(p.a)(e,[{key:"getErrorRemark",value:function(e){switch(e=this.normalizeError(e),console.log(e.message),e.message){case this.FAILED_TO_FETCH:return this.POOR_INTERNET_CONNECTION;case this.UNAUTHENTICATED_USER:case this.USER_NOT_FOUND:case this.POOR_INTERNET_CONNECTION:return e.message;default:return this.AN_ERROR_OCCURRED}}},{key:"getResponseError",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",new Error(this.AN_ERROR_OCCURRED));case 2:e.t0=t.status,e.next=401===e.t0?5:404===e.t0?6:7;break;case 5:return e.abrupt("return",new Error(this.UNAUTHENTICATED_USER));case 6:return e.abrupt("return",new Error(this.USER_NOT_FOUND));case 7:return e.abrupt("return",new Error(this.AN_ERROR_OCCURRED));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"normalizeError",value:function(e){return this.checkErrorBool(e)?(e.message=e.message.toLowerCase(),e):new Error(this.AN_ERROR_OCCURRED)}}]),e}());t.a=new function e(){var t=this;Object(u.a)(this,e),this.BASE_URL="https://my-chat-app-server-0707.herokuapp.com/mychatapp/v1/api",this.REQUEST_OPTIONS={method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}},this.getUserRequest=function(e,n){return fetch("".concat(t.BASE_URL,"/user/").concat(e),Object(c.a)(Object(c.a)({},t.REQUEST_OPTIONS),{},{method:"GET",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(n)}}))},this.loginRequest=function(e){return fetch("".concat(t.BASE_URL,"/user/login"),Object(c.a)(Object(c.a)({},t.REQUEST_OPTIONS),{},{method:"POST",body:JSON.stringify(e)}))},this.signupRequest=function(e){return fetch("".concat(t.BASE_URL,"/user/signup"),Object(c.a)(Object(c.a)({},t.REQUEST_OPTIONS),{},{method:"POST",body:JSON.stringify(e)}))},this.checkTokenRequest=function(e,n){return fetch("".concat(t.BASE_URL,"/user/refresh/").concat(e),Object(c.a)(Object(c.a)({},t.REQUEST_OPTIONS),{},{headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(n)}}))},this.getMessageRequest=function(e,n,r,a){var o=r.page,u=r.limit;return fetch("".concat(t.BASE_URL,"/message?page=").concat(o,"&limit=").concat(u),Object(c.a)(Object(c.a)({},t.REQUEST_OPTIONS),{},{method:"POST",body:JSON.stringify({userId:e,toUserId:n}),headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(a)}}))},this.loginUser=function(e){return function(){var n=Object(o.a)(a.a.mark((function n(r){var o,c,u;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r(i()),n.next=4,t.loginRequest(e);case 4:if(!(o=n.sent).ok){n.next=13;break}return n.next=8,o.json();case 8:if(!(c=n.sent).token){n.next=11;break}return n.abrupt("return",r(l(c)));case 11:n.next=14;break;case 13:throw E.getResponseError(o);case 14:n.next=22;break;case 16:return n.prev=16,n.t0=n.catch(0),n.next=20,n.t0;case 20:return u=n.sent,n.abrupt("return",r(m({error:E.getErrorRemark(u)})));case 22:case"end":return n.stop()}}),n,null,[[0,16]])})));return function(e){return n.apply(this,arguments)}}()},this.signupUser=function(e){return function(){var n=Object(o.a)(a.a.mark((function n(r){var o,c,u;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,r(i()),n.next=4,t.signupRequest(e);case 4:if(!(o=n.sent).ok){n.next=13;break}return n.next=8,o.json();case 8:if(!(c=n.sent).token){n.next=11;break}return n.abrupt("return",r(l(c)));case 11:n.next=14;break;case 13:throw E.getResponseError(o);case 14:n.next=22;break;case 16:return n.prev=16,n.t0=n.catch(0),n.next=20,n.t0;case 20:return u=n.sent,n.abrupt("return",r(m({error:E.getErrorRemark(u)})));case 22:case"end":return n.stop()}}),n,null,[[0,16]])})));return function(e){return n.apply(this,arguments)}}()},this.logoutUser=function(){return function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t({type:s.e}),e.next=4,h.a.unauthenticate();case 4:return e.abrupt("return",t({type:s.f}));case 7:return e.prev=7,e.t0=e.catch(0),e.next=11,t((n={error:e.t0.message},{type:s.d,payload:n}));case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}var n}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},this.checkToken=function(e,n){return function(){var r=Object(o.a)(a.a.mark((function r(o){var c,u,s;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o(i()),r.next=4,t.checkTokenRequest(e,n);case 4:if(!(c=r.sent).ok){r.next=13;break}return r.next=8,c.json();case 8:if(!(u=r.sent).token){r.next=11;break}return r.abrupt("return",o(l(u)));case 11:r.next=14;break;case 13:throw E.getResponseError(c);case 14:r.next=26;break;case 16:return r.prev=16,r.t0=r.catch(0),r.next=20,r.t0;case 20:if(s=r.sent,console.log(s),console.log(s.message),s.message!==E.UNAUTHENTICATED_USER){r.next=25;break}return r.abrupt("return",o(t.logoutUser()));case 25:return r.abrupt("return",o(m({error:E.POOR_INTERNET_CONNECTION})));case 26:case"end":return r.stop()}}),r,null,[[0,16]])})));return function(e){return r.apply(this,arguments)}}()},this.getUserDetails=function(e,n){return new Promise(function(){var r=Object(o.a)(a.a.mark((function r(o,c){var u,s;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.getUserRequest(e,n);case 3:if(!(u=r.sent).ok){r.next=15;break}return r.next=7,u.json();case 7:if("success"!==(s=r.sent).status){r.next=12;break}o(s.user),r.next=13;break;case 12:throw new Error("Could not get details");case 13:r.next=16;break;case 15:throw new Error("Could not get details");case 16:r.next=21;break;case 18:r.prev=18,r.t0=r.catch(0),c(r.t0);case 21:case"end":return r.stop()}}),r,null,[[0,18]])})));return function(e,t){return r.apply(this,arguments)}}())},this.getMessages=function(e,n,r,c){var u=r.page,s=r.limit;return new Promise(function(){var r=Object(o.a)(a.a.mark((function r(o,i){var l,m;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.getMessageRequest(e,n,{page:u,limit:s},c);case 3:if(!(l=r.sent).ok){r.next=15;break}return r.next=7,l.json();case 7:if("success"!==(m=r.sent).status){r.next=12;break}o(m),r.next=13;break;case 12:throw new Error("Could not load chats");case 13:r.next=16;break;case 15:throw new Error("Could not load chats");case 16:r.next=21;break;case 18:r.prev=18,r.t0=r.catch(0),i({error:r.t0});case 21:case"end":return r.stop()}}),r,null,[[0,18]])})));return function(e,t){return r.apply(this,arguments)}}())}}},,function(e,t,n){"use strict";var r=n(0),a=n.n(r);n(37);t.a=function(){return a.a.createElement("span",{className:"spinner"})}},,,,,function(e,t,n){e.exports=n.p+"static/media/logo.e60f0d19.svg"},,,,,,,,function(e,t,n){"use strict";var r=n(0),a=n.n(r),o=n(22);n(37);t.a=function(){return a.a.createElement("div",{className:"spinner-page"},a.a.createElement(o.a,null))}},,function(e,t,n){},,function(e,t,n){},,,function(e,t,n){e.exports=n(58)},,,,,function(e,t,n){},function(e,t,n){},,,,,function(e,t,n){},function(e,t,n){},,,function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(25),c=n.n(o),u=(n(47),n(10)),s=n(16),i=n(19),l=n(18),m=n(13),h=n(3),p=(n(48),n(28)),E=n(7),f=function(e){var t=e.component,n=Object(p.a)(e,["component"]);return a.a.createElement(h.b,Object.assign({},n,{render:function(e){return!0===E.a.isAuthenticated()?a.a.createElement(t,e):a.a.createElement(h.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},d=function(e){var t=e.component,n=Object(p.a)(e,["component"]);return a.a.createElement(h.b,Object.assign({},n,{render:function(e){return!1===E.a.isAuthenticated()?a.a.createElement(t,e):a.a.createElement(h.a,{to:"/chat"})}}))},b=n(35),g=(n(53),Object(r.lazy)((function(){return Promise.all([n.e(2),n.e(4)]).then(n.bind(null,126))}))),v=function(e){Object(i.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e=this.props.location.pathname;return a.a.createElement("div",{className:"main-in"},a.a.createElement("div",{className:"container"},a.a.createElement(r.Suspense,{fallback:a.a.createElement(b.a,null)},a.a.createElement(h.d,null,a.a.createElement(h.b,{path:"/in",exact:!0}," ",a.a.createElement(h.a,{to:"".concat(e,"/chat")})," "),a.a.createElement(h.b,{path:"/in/chat",exact:!0,component:g})))))}}]),n}(a.a.Component),O=Object(h.g)(v),k=n(12),j=(n(54),function(){var e=Object(r.useState)(""),t=Object(k.a)(e,2),n=t[0],o=t[1],c=Object(r.useState)(""),u=Object(k.a)(c,2),s=u[0],i=u[1],l=Object(r.useState)(!1),m=Object(k.a)(l,2),p=m[0],E=m[1];return p?a.a.createElement(h.a,{to:"/chat?name=".concat(n,"&room=").concat(s)}):a.a.createElement("div",{id:"join-bx"},a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),s.trim().length>0&&n.trim().length>0&&E(!0)}},a.a.createElement("h2",null,"Join A Server ",a.a.createElement("span",{role:"img","aria-label":"rocket"},"\ud83d\ude80")),a.a.createElement("input",{placeholder:"Your Name",type:"name",onChange:function(e){return o(e.target.value)}}),a.a.createElement("input",{placeholder:"Room Name",type:"room",onChange:function(e){return i(e.target.value)}}),a.a.createElement("div",null,a.a.createElement("button",{type:"submit",disabled:!(s.trim().length>0&&n.trim().length>0)},"Join"))))}),R=n(14),C=n(22),_=n(17),w=n(20),y=(n(39),n(27)),N=n.n(y),T=function(e){var t=Object(r.useState)(""),n=Object(k.a)(t,2),o=n[0],c=n[1],u=Object(r.useState)(""),s=Object(k.a)(u,2),i=s[0],l=s[1],p=Object(R.c)(),f=Object(R.d)((function(e){return e.auth})),d=f.error,b=f.isLoading,g=f.token,v=f.userId,O=function(e){e.preventDefault(),p(w.a.loginUser({username:o,password:i}))},j=(e.location.state||{from:{pathname:"/"}}).from;return g?(E.a.authenticate(v,g,(function(){return a.a.createElement(h.a,{to:j.pathname})})),a.a.createElement(h.a,{to:j.pathname})):a.a.createElement(_.a.Consumer,null,(function(t){var n=t.theme;return a.a.createElement("main",{className:"form-page",style:{background:n.backgroundColor,color:n.textColor}},a.a.createElement("form",{onSubmit:O},a.a.createElement("h2",null," ",a.a.createElement("img",{src:N.a,alt:"logo"})," YouChat "),a.a.createElement("h3",null,e.location.state?"Yeah! You have to login":"Welcome Back!"," ",a.a.createElement("span",{role:"img","aria-label":"cool"},"\ud83d\ude0e")),a.a.createElement("input",{placeholder:"Your Username",value:o,type:"name",onChange:function(e){return c(e.target.value)},style:{color:n.textColor}}),a.a.createElement("input",{placeholder:"Password",value:i,type:"password",onChange:function(e){return l(e.target.value)},style:{color:n.textColor}}),d?a.a.createElement("div",{className:"error"},d):"",a.a.createElement("div",null,a.a.createElement("button",{type:"submit",disabled:!(i.trim().length>0&&o.trim().length>0)},"Login",b?a.a.createElement(C.a,null):"")),a.a.createElement("div",{className:"redirect"},"You don't have an account?",a.a.createElement(m.b,{to:"/signup"},"Sign Up"))))}))},x=function(e){var t=Object(r.useState)(""),n=Object(k.a)(t,2),o=n[0],c=n[1],u=Object(r.useState)(""),s=Object(k.a)(u,2),i=s[0],l=s[1],p=Object(r.useState)(""),f=Object(k.a)(p,2),d=f[0],b=f[1],g=Object(R.c)(),v=Object(R.d)((function(e){return e.auth})),O=v.error,j=v.userId,y=v.isLoading,T=v.token,x=function(e){e.preventDefault(),g(w.a.signupUser({username:o,email:i,password:d}))},S=(e.location.state||{from:{pathname:"/"}}).from;return T?(E.a.authenticate(j,T,(function(){return a.a.createElement(h.a,{to:S.pathname})})),a.a.createElement(h.a,{to:S.pathname})):a.a.createElement(_.a.Consumer,null,(function(e){return a.a.createElement("main",{className:"".concat(e," form-page")},a.a.createElement("form",{onSubmit:x},a.a.createElement("h2",null," ",a.a.createElement("img",{src:N.a,alt:"logo"}),"   YouChat "),a.a.createElement("h3",null," Join and Start a Conversation ",a.a.createElement("span",{role:"img","aria-label":"rocket"},"\ud83d\ude80")),a.a.createElement("input",{placeholder:"Your Username",value:o,type:"name",onChange:function(e){return c(e.target.value)}}),a.a.createElement("input",{placeholder:"Your Email",value:i,type:"email",onChange:function(e){return l(e.target.value)}}),a.a.createElement("input",{placeholder:"Password",value:d,type:"password",onChange:function(e){return b(e.target.value)}}),a.a.createElement("div",{className:"error"},O||""),a.a.createElement("div",null,a.a.createElement("button",{type:"submit",disabled:!(d.trim().length>0&&o.trim().length>0)},"Create",y?a.a.createElement(C.a,null):"")),a.a.createElement("div",{className:"redirect"},a.a.createElement(m.b,{to:"/login"},"Login"),", If you have an account")))}))},S=(n(57),function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"notfound-top"},a.a.createElement("span",{onClick:function(){return window.history.back()}},"Go Back")),a.a.createElement("main",{className:"notfound-bx"},a.a.createElement("span",null,"4"),a.a.createElement("span",null,"0"),a.a.createElement("span",null,"4")))}),U=function(e){Object(i.a)(n,e);var t=Object(l.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"componentDidMount",value:function(){if(E.a.isAuthenticated()){var e=E.a.getAuthValue(),t=e.userId,n=e.token;this.props.checkUserToken(t,n)}}},{key:"render",value:function(){return a.a.createElement(_.a.Consumer,null,(function(e){var t=e.theme;return a.a.createElement("div",{className:"app-body",style:{background:t.backgroundColor,color:t.textColor}},a.a.createElement(m.a,{basename:"/my-react-chat-app"},a.a.createElement(h.d,null,a.a.createElement(h.b,{path:"/",exact:!0},a.a.createElement(h.a,{to:"/in"})),a.a.createElement(f,{path:"/in",component:O}),a.a.createElement(h.b,{path:"/join",component:j}),a.a.createElement(d,{path:"/login",component:T}),a.a.createElement(d,{path:"/signup",component:x}),a.a.createElement(h.b,{path:"*",component:S}))))}))}}]),n}(r.Component),I=Object(R.b)((function(e){return{userId:e.auth.userId,token:e.auth.token}}),(function(e){return{checkUserToken:function(t,n){return e(w.a.checkToken(t,n))}}}))(U);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var A=n(1),P=n(6),D={token:null,error:null,userId:null,isLoading:!1},L=n(23),B=n(41),F=Object(L.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case P.b:return Object(A.a)(Object(A.a)({},e),{},{isLoading:!0,error:null});case P.c:return Object(A.a)(Object(A.a)({},e),{},{token:r.token,isLoading:!1,userId:r.userId,error:null});case P.a:return Object(A.a)(Object(A.a)({},e),{},{token:null,isLoading:!1,userId:null,error:r.error});case P.e:return Object(A.a)(Object(A.a)({},e),{},{isLoading:!0,error:null});case P.f:return Object(A.a)(Object(A.a)({},e),{},{token:null,isLoading:!1,userId:null,error:null});case P.d:return Object(A.a)(Object(A.a)({},e),{},{token:null,isLoading:!1,userId:null,error:r.error});default:return e}}}),Y=Object(L.d)(F,Object(L.a)(B.a));c.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(R.a,{store:Y},a.a.createElement(_.a.Provider,{value:"day"},a.a.createElement(I,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[42,1,3]]]);
//# sourceMappingURL=main.d9f4296d.chunk.js.map