(this["webpackJsonpreact-chat-app"]=this["webpackJsonpreact-chat-app"]||[]).push([[0],{104:function(e,t){},108:function(e,t,n){},110:function(e,t,n){},111:function(e,t,n){},112:function(e,t,n){},113:function(e,t,n){},115:function(e,t,n){},116:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){},119:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(30),o=n.n(s),c=(n(72),n(5)),i=n(7),l=n(14),u=n(13),m=n(16),h=n(4),d=(n(73),n(34)),g=new function e(){var t=this;Object(c.a)(this,e),this.USER_TOKEN_KEY="user_token_key",this.USER_ID_KEY="user_id_key",this.getAuthValue=function(){return{token:window.localStorage.getItem(t.USER_TOKEN_KEY),userId:window.localStorage.getItem(t.USER_ID_KEY)}},this.isAuthenticated=function(){return Boolean(window.localStorage.getItem(t.USER_TOKEN_KEY))},this.authenticate=function(e,n,a){if(window.localStorage.setItem(t.USER_TOKEN_KEY,n),window.localStorage.setItem(t.USER_ID_KEY,e),a&&"function"===typeof a)return a()},this.unauthenticate=function(e){window.localStorage.clear(),e&&"function"===typeof e&&e()}},p=function(e){var t=e.component,n=Object(d.a)(e,["component"]);return r.a.createElement(h.b,Object.assign({},n,{render:function(e){return!0===g.isAuthenticated()?r.a.createElement(t,e):r.a.createElement(h.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},f=function(e){var t=e.component,n=Object(d.a)(e,["component"]);return r.a.createElement(h.b,Object.assign({},n,{render:function(e){return!1===g.isAuthenticated()?r.a.createElement(t,e):r.a.createElement(h.a,{to:"/chat"})}}))},E=n(17),v=n(6),b=n(61),C=n.n(b),w=n(107),k=new(function(){function e(){Object(c.a)(this,e),this.socket=null,this.eventEmitter=new w.EventEmitter}return Object(i.a)(e,[{key:"createSocketConnection",value:function(e){try{this.socket=C.a.connect("http://localhost:4001",{query:"userId=".concat(e)})}catch(t){throw new Error("Something went wrong. We can't connect to server")}return!0}},{key:"getChatList",value:function(e){var t=this;this.socket.emit("chat-list",{userId:e},(function(e){var n=e.error,a=e.message;n&&t.eventEmitter.emit("chat-list-response",{error:n,message:a})})),this.socket.on("chat-list-response",(function(e){t.eventEmitter.emit("chat-list-response",e)}))}},{key:"sendMessage",value:function(e){this.socket.emit("add-message",e)}},{key:"receiveMessage",value:function(){var e=this;this.socket.on("add-message-response",(function(t){e.eventEmitter.emit("add-message-response",t)}))}},{key:"typingMessage",value:function(e){this.socket.emit("typing-message",{toUserId:e},(function(e){e.error;var t=e.message;console.log("error",t)}))}},{key:"receiveTypingMessage",value:function(){var e=this;this.socket.on("typing-message-response",(function(t){e.eventEmitter.emit("typing-message-response",t)}))}}]),e}()),O=(n(108),r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},r.a.createElement("path",{d:"M 3.59375 5.34375 L 4.03125 7.21875 L 5.96875 16 L 4.03125 24.78125 L 3.59375 26.65625 L 5.375 25.9375 L 27.375 16.9375 L 29.65625 16 L 27.375 15.0625 L 5.375 6.0625 Z M 6.375 8.65625 L 21.90625 15 L 7.78125 15 Z M 7.78125 17 L 21.90625 17 L 6.375 23.34375 Z"}))),S=r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},r.a.createElement("path",{d:"M 11.5 6 C 9.578125 6 8 7.578125 8 9.5 C 8 11.421875 9.578125 13 11.5 13 C 13.421875 13 15 11.421875 15 9.5 C 15 7.578125 13.421875 6 11.5 6 Z M 20.5 6 C 18.578125 6 17 7.578125 17 9.5 C 17 11.421875 18.578125 13 20.5 13 C 22.421875 13 24 11.421875 24 9.5 C 24 7.578125 22.421875 6 20.5 6 Z M 11.5 8 C 12.339844 8 13 8.660156 13 9.5 C 13 10.339844 12.339844 11 11.5 11 C 10.660156 11 10 10.339844 10 9.5 C 10 8.660156 10.660156 8 11.5 8 Z M 20.5 8 C 21.339844 8 22 8.660156 22 9.5 C 22 10.339844 21.339844 11 20.5 11 C 19.660156 11 19 10.339844 19 9.5 C 19 8.660156 19.660156 8 20.5 8 Z M 7 12 C 4.800781 12 3 13.800781 3 16 C 3 17.113281 3.476563 18.117188 4.21875 18.84375 C 2.886719 19.746094 2 21.28125 2 23 L 4 23 C 4 21.332031 5.332031 20 7 20 C 8.667969 20 10 21.332031 10 23 L 12 23 C 12 21.28125 11.113281 19.746094 9.78125 18.84375 C 10.523438 18.117188 11 17.113281 11 16 C 11 13.800781 9.199219 12 7 12 Z M 12 23 C 11.375 23.835938 11 24.886719 11 26 L 13 26 C 13 24.332031 14.332031 23 16 23 C 17.667969 23 19 24.332031 19 26 L 21 26 C 21 24.886719 20.625 23.835938 20 23 C 19.660156 22.546875 19.25 22.160156 18.78125 21.84375 C 19.523438 21.117188 20 20.113281 20 19 C 20 16.800781 18.199219 15 16 15 C 13.800781 15 12 16.800781 12 19 C 12 20.113281 12.476563 21.117188 13.21875 21.84375 C 12.75 22.160156 12.339844 22.546875 12 23 Z M 20 23 L 22 23 C 22 21.332031 23.332031 20 25 20 C 26.667969 20 28 21.332031 28 23 L 30 23 C 30 21.28125 29.113281 19.746094 27.78125 18.84375 C 28.523438 18.117188 29 17.113281 29 16 C 29 13.800781 27.199219 12 25 12 C 22.800781 12 21 13.800781 21 16 C 21 17.113281 21.476563 18.117188 22.21875 18.84375 C 20.886719 19.746094 20 21.28125 20 23 Z M 7 14 C 8.117188 14 9 14.882813 9 16 C 9 17.117188 8.117188 18 7 18 C 5.882813 18 5 17.117188 5 16 C 5 14.882813 5.882813 14 7 14 Z M 25 14 C 26.117188 14 27 14.882813 27 16 C 27 17.117188 26.117188 18 25 18 C 23.882813 18 23 17.117188 23 16 C 23 14.882813 23.882813 14 25 14 Z M 16 17 C 17.117188 17 18 17.882813 18 19 C 18 20.117188 17.117188 21 16 21 C 14.882813 21 14 20.117188 14 19 C 14 17.882813 14.882813 17 16 17 Z"})),y=r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},r.a.createElement("path",{d:"M 16 4 C 9.382813 4 4 9.382813 4 16 C 4 22.617188 9.382813 28 16 28 C 22.617188 28 28 22.617188 28 16 C 28 9.382813 22.617188 4 16 4 Z M 16 6 C 21.535156 6 26 10.464844 26 16 C 26 21.535156 21.535156 26 16 26 C 10.464844 26 6 21.535156 6 16 C 6 10.464844 10.464844 6 16 6 Z M 11.5 12 C 10.671875 12 10 12.671875 10 13.5 C 10 14.328125 10.671875 15 11.5 15 C 12.328125 15 13 14.328125 13 13.5 C 13 12.671875 12.328125 12 11.5 12 Z M 20.5 12 C 19.671875 12 19 12.671875 19 13.5 C 19 14.328125 19.671875 15 20.5 15 C 21.328125 15 22 14.328125 22 13.5 C 22 12.671875 21.328125 12 20.5 12 Z M 10.8125 19 L 9.09375 20 C 10.476563 22.386719 13.046875 24 16 24 C 18.953125 24 21.523438 22.386719 22.90625 20 L 21.1875 19 C 20.148438 20.792969 18.226563 22 16 22 C 13.773438 22 11.851563 20.792969 10.8125 19 Z"})),U=r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},r.a.createElement("path",{d:"M 4 7 L 4 9 L 28 9 L 28 7 Z M 4 15 L 4 17 L 28 17 L 28 15 Z M 4 23 L 4 25 L 28 25 L 28 23 Z"})),R=r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},r.a.createElement("path",{d:"M 7.21875 5.78125 L 5.78125 7.21875 L 14.5625 16 L 5.78125 24.78125 L 7.21875 26.21875 L 16 17.4375 L 24.78125 26.21875 L 26.21875 24.78125 L 17.4375 16 L 26.21875 7.21875 L 24.78125 5.78125 L 16 14.5625 Z"})),x=r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},r.a.createElement("path",{d:"M 19 3 C 13.488281 3 9 7.488281 9 13 C 9 15.394531 9.839844 17.589844 11.25 19.3125 L 3.28125 27.28125 L 4.71875 28.71875 L 12.6875 20.75 C 14.410156 22.160156 16.605469 23 19 23 C 24.511719 23 29 18.511719 29 13 C 29 7.488281 24.511719 3 19 3 Z M 19 5 C 23.429688 5 27 8.570313 27 13 C 27 17.429688 23.429688 21 19 21 C 14.570313 21 11 17.429688 11 13 C 11 8.570313 14.570313 5 19 5 Z"})),L=n(8),_=n(2),j=n.n(_),N=n(10),T=n(3),I=function(e){return{type:"login_user_success",payload:e}},M=function(e){return{type:"login_user_failed",payload:e}},P=new(function(){function e(){Object(c.a)(this,e),this.FAILED_TO_FETCH="failed to fetch",this.AN_ERROR_OCCURRED="An Error Occurred",this.POOR_INTERNET_CONNECTION="Poor Internet Connection",this.UNAUTHENTICATED_USER="You have to Login",this.USER_NOT_FOUND="User not found",this.checkErrorBool=function(e){return e&&null!==e.message}}return Object(i.a)(e,[{key:"getErrorRemark",value:function(e){switch((e=this.normalizeError(e)).message){case this.FAILED_TO_FETCH:return this.POOR_INTERNET_CONNECTION;case this.UNAUTHENTICATED_USER:case this.USER_NOT_FOUND:case this.POOR_INTERNET_CONNECTION:return e.message;default:return this.AN_ERROR_OCCURRED}}},{key:"getResponseError",value:function(){var e=Object(N.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",new Error(this.AN_ERROR_OCCURRED));case 2:e.t0=t.status,e.next=401===e.t0?5:404===e.t0?6:7;break;case 5:return e.abrupt("return",new Error(this.UNAUTHENTICATED_USER));case 6:return e.abrupt("return",new Error(this.USER_NOT_FOUND));case 7:return e.abrupt("return",new Error(this.AN_ERROR_OCCURRED));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"normalizeError",value:function(e){return this.checkErrorBool(e)?(e.message=e.message.toLowerCase(),e):new Error(this.AN_ERROR_OCCURRED)}}]),e}()),B=new function e(){var t=this;Object(c.a)(this,e),this.BASE_URL="http://localhost:4001/mychatapp/v1/api",this.REQUEST_OPTIONS={method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}},this.getUserRequest=function(e,n){return fetch("".concat(t.BASE_URL,"/user/").concat(e),Object(T.a)(Object(T.a)({},t.REQUEST_OPTIONS),{},{method:"GET",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(n)}}))},this.loginRequest=function(e){return fetch("".concat(t.BASE_URL,"/user/login"),Object(T.a)(Object(T.a)({},t.REQUEST_OPTIONS),{},{method:"POST",body:JSON.stringify(e)}))},this.signupRequest=function(e){return fetch("".concat(t.BASE_URL,"/user/signup"),Object(T.a)(Object(T.a)({},t.REQUEST_OPTIONS),{},{method:"POST",body:JSON.stringify(e)}))},this.checkTokenRequest=function(e,n){return fetch("".concat(t.BASE_URL,"/user/refresh/").concat(e),Object(T.a)(Object(T.a)({},t.REQUEST_OPTIONS),{},{headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(n)}}))},this.getMessageRequest=function(e,n,a,r){var s=a.page,o=a.limit;return fetch("".concat(t.BASE_URL,"/message?page=").concat(s,"&limit=").concat(o),Object(T.a)(Object(T.a)({},t.REQUEST_OPTIONS),{},{method:"POST",body:JSON.stringify({userId:e,toUserId:n}),headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(r)}}))},this.loginUser=function(e){return function(){var n=Object(N.a)(j.a.mark((function n(a){var r,s,o;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a({type:"login_user_pending"}),n.next=4,t.loginRequest(e);case 4:if(!(r=n.sent).ok){n.next=13;break}return n.next=8,r.json();case 8:if(!(s=n.sent).token){n.next=11;break}return n.abrupt("return",a(I(s)));case 11:n.next=14;break;case 13:throw P.getResponseError(r);case 14:n.next=22;break;case 16:return n.prev=16,n.t0=n.catch(0),n.next=20,n.t0;case 20:return o=n.sent,n.abrupt("return",a(M({error:P.getErrorRemark(o)})));case 22:case"end":return n.stop()}}),n,null,[[0,16]])})));return function(e){return n.apply(this,arguments)}}()},this.signupUser=function(e){return function(){var n=Object(N.a)(j.a.mark((function n(a){var r,s,o;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a({type:"login_user_pending"}),n.next=4,t.signupRequest(e);case 4:if(!(r=n.sent).ok){n.next=13;break}return n.next=8,r.json();case 8:if(!(s=n.sent).token){n.next=11;break}return n.abrupt("return",a(I(s)));case 11:n.next=14;break;case 13:throw P.getResponseError(r);case 14:n.next=22;break;case 16:return n.prev=16,n.t0=n.catch(0),n.next=20,n.t0;case 20:return o=n.sent,n.abrupt("return",a(M({error:P.getErrorRemark(o)})));case 22:case"end":return n.stop()}}),n,null,[[0,16]])})));return function(e){return n.apply(this,arguments)}}()},this.logoutUser=function(){return function(){var e=Object(N.a)(j.a.mark((function e(t){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t({type:"logout_user_pending"}),e.next=4,g.unauthenticate();case 4:return e.abrupt("return",t({type:"logout_user_success"}));case 7:return e.prev=7,e.t0=e.catch(0),e.next=11,t({type:"logout_user_failed",payload:{error:e.t0.message}});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},this.checkToken=function(e,n){return function(){var a=Object(N.a)(j.a.mark((function a(r){var s,o,c;return j.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,r({type:"login_user_pending"}),a.next=4,t.checkTokenRequest(e,n);case 4:if(!(s=a.sent).ok){a.next=13;break}return a.next=8,s.json();case 8:if(!(o=a.sent).token){a.next=11;break}return a.abrupt("return",r(I(o)));case 11:a.next=14;break;case 13:throw P.getResponseError(s);case 14:a.next=26;break;case 16:return a.prev=16,a.t0=a.catch(0),a.next=20,a.t0;case 20:if(c=a.sent,console.log(c),console.log(c.message),c.message!==P.UNAUTHENTICATED_USER){a.next=25;break}return a.abrupt("return",r(t.logoutUser()));case 25:return a.abrupt("return",r(M({error:P.POOR_INTERNET_CONNECTION})));case 26:case"end":return a.stop()}}),a,null,[[0,16]])})));return function(e){return a.apply(this,arguments)}}()},this.getUserDetails=function(e,n){return new Promise(function(){var a=Object(N.a)(j.a.mark((function a(r,s){var o,c;return j.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.getUserRequest(e,n);case 3:if(!(o=a.sent).ok){a.next=15;break}return a.next=7,o.json();case 7:if("success"!==(c=a.sent).status){a.next=12;break}r(c.user),a.next=13;break;case 12:throw new Error("Could not get details");case 13:a.next=16;break;case 15:throw new Error("Could not get details");case 16:a.next=21;break;case 18:a.prev=18,a.t0=a.catch(0),s(a.t0);case 21:case"end":return a.stop()}}),a,null,[[0,18]])})));return function(e,t){return a.apply(this,arguments)}}())},this.getMessages=function(e,n,a,r){var s=a.page,o=a.limit;return new Promise(function(){var a=Object(N.a)(j.a.mark((function a(c,i){var l,u;return j.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.getMessageRequest(e,n,{page:s,limit:o},r);case 3:if(!(l=a.sent).ok){a.next=15;break}return a.next=7,l.json();case 7:if("success"!==(u=a.sent).status){a.next=12;break}c(u),a.next=13;break;case 12:throw new Error("Could not load chats");case 13:a.next=16;break;case 15:throw new Error("Could not load chats");case 16:a.next=21;break;case 18:a.prev=18,a.t0=a.catch(0),i({error:a.t0});case 21:case"end":return a.stop()}}),a,null,[[0,18]])})));return function(e,t){return a.apply(this,arguments)}}())}};n(58);var A=function(){return r.a.createElement("span",{className:"spinner"})},D=(n(110),n(111),function(e){var t=e.user,n=e.isSelected,a=e.setSelectedUser,s=e.isTyping,o=void 0!==s&&s;return r.a.createElement("li",{className:" chatlist--item ".concat(n?"active":""),onClick:a},r.a.createElement("div",{className:"chat-image ".concat("Y"===t.online?"online":"")},t.imageUrl?r.a.createElement("img",{src:t.imageUrl,alt:"profile"}):r.a.createElement(r.a.Fragment,null),r.a.createElement("div",{className:"online-trk"})),r.a.createElement("div",{className:"chat-person"},r.a.createElement("span",{className:"chat-person--name"},t.username),o?r.a.createElement("small",{className:"chat-person--typing"},"typing"):r.a.createElement(r.a.Fragment,null)))}),F=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).searchKey=function(e){a.setState({searchTerm:e.target.value})},a.renderChatList=function(e){if(e.error)console.log("chatlist",e.error);else{var t=a.state.chatListUsers;if(e.singleUser)t&&(t.length>0&&(t=t.filter((function(t){return t._id!==e.chatList._id}))),t=[e.chatList].concat(Object(E.a)(t)));else if(e.userDisconnected){var n=t.findIndex((function(t){return t._id===e.userId}));n>=0&&(t[n].online="N")}else t=e.chatList;a.setState({chatListUsers:t})}},a.state={selectedUserId:null,chatListUsers:null,searchTerm:""},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){k.getChatList(this.props.userId),k.eventEmitter.on("chat-list-response",this.renderChatList)}},{key:"componentWillUnmount",value:function(){k.eventEmitter.removeListener("chat-list-response",this.renderChatList)}},{key:"updateSelectedUser",value:function(e){this.setState({selectedUserId:e._id}),this.props.updateSelectedUser(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.isMobileViewPort,a=t.toggleValue;return r.a.createElement("aside",{ref:this.props.sidebarRef,className:"chat-list ".concat(n?"float ".concat(a?"":"hide"):"")},this.state.chatListUsers?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"aside-top"},this.state.chatListUsers.length>0?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"search-pane"},this.state.searchTerm.trim().length>0?r.a.createElement("span",{className:"close-search",onClick:function(){return e.setState({searchTerm:""})}},r.a.createElement("div",null,R)):r.a.createElement("span",null,x),r.a.createElement("input",{type:"text",placeholder:"Find a chat here",onChange:this.searchKey,value:this.state.searchTerm})),r.a.createElement("span",{className:"group-btn"},S)):r.a.createElement(r.a.Fragment,null)),r.a.createElement("ul",null,this.state.chatListUsers.filter((function(t){return t.username.toLowerCase().includes(e.state.searchTerm.trim().toLowerCase())})).map((function(t,n){return r.a.createElement(D,{key:"chat-user".concat(n),isTyping:e.props.typing[t._id],isSelected:e.state.selectedUserId===t._id,user:t,setSelectedUser:function(){return e.updateSelectedUser(t)}})}))),r.a.createElement("div",{className:"aside-bottom"})):r.a.createElement(r.a.Fragment,null),r.a.createElement("div",{className:"alert \n                    ".concat(this.state.loading?"alert-info":""," \n                    ").concat(this.state.chatListUsers&&this.state.chatListUsers.length>0?"visibility-hidden":"")},this.state.chatListUsers?0===this.state.chatListUsers.length?"No User Available to chat.":"Error loading your chat! We will keep trying":"Loading your chat list."))}}]),n}(a.Component),V=Object(v.b)((function(e){var t=e.auth;return{userId:t.userId,token:t.token}}))(F),Z=n(33),Y=n.n(Z),H=(n(112),n(113),n(62)),q=n.n(H),K=function(){return r.a.createElement("div",{className:"spinner-page"},r.a.createElement(A,null))},z=n(63),W=n.n(z),J=n(64),Q=n.n(J),G=(n(115),function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this)).addScrollEvent=function(){e.scrollBoxRef.addEventListener("scroll",Q.a.throttle(e.handleScrolling),!1),document.addEventListener("DOMContentLoaded",e.handleScrolling,!1)},e.handleScrolling=function(){var t=Object(N.a)(j.a.mark((function t(n){var a;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(parseInt(e.props.page)>1&&e.scrollBoxRef.scrollTop<=30?(a=(30-e.scrollBoxRef.scrollTop)/30*100,e.setState({loadingOffset:a-100})):e.setState({loadingOffset:-100}),e.state.loading){t.next=16;break}if(!(e.scrollBoxRef.scrollTop<=0)){t.next=16;break}return t.prev=3,e.setState({loading:!0}),t.next=7,e.props.onScrollPageRequest();case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),console.warn(t.t0);case 12:return t.prev=12,e.setState({loading:!1}),e.setState((function(t){var n=e.contentBoxRef.getBoundingClientRect().height;return e.scrollBoxRef.scrollTo(0,n-t.boxHeight),{boxHeight:n}})),t.finish(12);case 16:case"end":return t.stop()}}),t,null,[[3,9,12,16]])})));return function(e){return t.apply(this,arguments)}}(),e.scrollBoxRef=null,e.contentBoxRef=null,e.loadingRef=r.a.createRef(),e.state={paddingTop:"30px",loading:!1,loadingOffset:-100,boxHeight:0},e}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.props.onScrollBoxMount(this.scrollBoxRef,this.contentBoxRef),this.setState({boxHeight:this.contentBoxRef.getBoundingClientRect().height}),this.addScrollEvent()}},{key:"handleObserver",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{ref:function(t){return e.scrollBoxRef=t},className:"scrollBox ".concat(this.props.className),style:{paddingTop:this.state.paddingTop}},r.a.createElement("div",{ref:this.loadingRef,className:"scrollBox--loader",style:{height:this.state.paddingTop,top:this.state.loading?0:"".concat(this.state.loadingOffset,"%")}},"Loading"),r.a.createElement("div",{ref:function(t){return e.contentBoxRef=t},className:"scrollBox--content ".concat(this.props.contentClassName)},this.props.children))}}]),n}(a.Component)),$=n(65),X=n.n($);var ee=function(e){var t=this,n=e.asset,a=(e.throttle,e.volume),r=void 0===a?.5:a;this.asset=function(e){if(!e)throw new Error("Invalid resource");return e}(n),this.volume=r,this.play=function(){new Audio(t.asset).play().then().catch(console.log)}},te=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).receiveSocketMessages=function(e){var t=a.state.selectedUser;null!==t&&t._id===e.fromUserId&&(a.setState({messages:[].concat(Object(E.a)(a.state.messages),[e])}),a.scrollMessageContainer(),a.notifySound.play())},a.getMessages=Object(N.a)(j.a.mark((function e(){var t,n,r,s,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=a.props,n=t.userId,r=t.selectedUser,s=t.token,e.next=4,B.getMessages(n,r._id,{page:a.state.page,limit:a.state.limit},s);case 4:(o=e.sent).error?alert("Unable to fetch messages"):(a.setState({messages:o.messages,page:o.currentPage,totalPages:o.totalPages}),a.scrollMessageContainer()),a.setState({messageLoading:!1}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),a.setState({messageLoading:!1});case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),a.sendMessage=function(e){var t=a.props,n=t.userId,r=t.selectedUser;if("Enter"===e.key){var s=e.target.value;""===s||void 0===s||null===s?alert("message can't be empty"):""===n||r&&void 0!==r&&(a.sendAndUpdateMessages({fromUserId:n,text:s.trim(),toUserId:r._id}),e.target.value="")}else k.typingMessage(r._id)},a.onScrollBoxMount=function(e,t){a.messagesBox=e,a.messageContentBox=t,a.scrollMessageContainer()},a.handleScrollPageRequest=Object(N.a)(j.a.mark((function e(){var t,n,r,s,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(parseInt(a.state.page)>1)){e.next=12;break}return e.prev=1,t=a.props,n=t.userId,r=t.selectedUser,s=t.token,e.next=5,B.getMessages(n,r._id,{page:a.state.page-1,limit:a.state.limit},s);case 5:(o=e.sent).error?alert("Unable to fetch messages"):a.setState({messages:[].concat(Object(E.a)(o.messages),Object(E.a)(a.state.messages)),page:o.currentPage,totalPages:o.totalPages}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])}))),a.handleScrollPageResult=function(e){console.log(e)},a.renderMessages=function(){if(0===a.state.messages.length)return[];var e=new Date(a.state.messages[0].date);return a.state.messages.map((function(t,n){var s,o,c=new Date(t.date),i=(o=e,!((s=c).getFullYear()===o.getFullYear()&&s.getMonth()===o.getMonth()&&s.getDate()===o.getDate())&&c.getTime()>e.getTime());return i&&(e=c),r.a.createElement(r.a.Fragment,{key:"chat-msg-".concat(n)},i?r.a.createElement("div",{className:"chat-date-bk"},r.a.createElement("div",null),r.a.createElement("span",null,e.toDateString()),r.a.createElement("div",null)):r.a.createElement(r.a.Fragment,null),r.a.createElement(ne,{key:"chat-bx-".concat(n),isAuth:t.fromUserId===a.props.userId,message:t}))}))},a.renderChatUI=function(){return r.a.createElement("main",{className:"chat-room",role:"main"},0===a.state.page?a.renderStartChatUI():r.a.createElement(r.a.Fragment,null),r.a.createElement(G,{scrollBoxRef:a.messagesBox,onScrollPageRequest:a.handleScrollPageRequest,onScrollPageResponse:a.handleScrollPageResult,onScrollBoxMount:a.onScrollBoxMount,className:"chat-bx",contentClassName:"content-bx"},r.a.createElement(r.a.Fragment,null,parseInt(a.state.page)<=1||null===a.state.page?a.renderStartChatUI():r.a.createElement(r.a.Fragment,null),a.renderMessages())),r.a.createElement("div",{className:"bottom-bar"},r.a.createElement("span",null,y),r.a.createElement("input",{placeholder:"Send a message",onKeyPress:a.sendMessage}),r.a.createElement("span",null,O)))},a.renderNoUserSelectedUI=function(){return r.a.createElement("div",{className:"no-chat-select-bx"},r.a.createElement("img",{src:Y.a,alt:"No Selected User"}))},a.renderStartChatUI=function(){return r.a.createElement("div",{className:"chat-start-bx"},r.a.createElement("img",{src:q.a,alt:"Start Conversation"}))},a.messagesBox=null,a.messageContentBox=null,a.notifySound=new ee({asset:X.a}),a.state={messageLoading:!0,messages:[],selectedUser:null,page:null,limit:10,totalPages:null},a}return Object(i.a)(n,[{key:"componentDidUpdate",value:function(e){null!==e.selectedUser&&this.props.selectedUser._id===e.selectedUser._id||this.getMessages()}},{key:"componentDidMount",value:function(){k.receiveMessage(),k.eventEmitter.on("add-message-response",this.receiveSocketMessages)}},{key:"componentWillUnmount",value:function(){k.eventEmitter.removeListener("add-message-response",this.receiveSocketMessages)}},{key:"sendAndUpdateMessages",value:function(e){try{k.sendMessage(e),this.setState({messages:[].concat(Object(E.a)(this.state.messages),[e])}),this.scrollMessageContainer()}catch(t){console.error("error"),alert("Can't send your message")}}},{key:"scrollMessageContainer",value:function(){var e=this;if(null!==this.messagesBox)try{setTimeout((function(){e.messagesBox.scrollTo(0,e.messageContentBox.scrollHeight)}),100)}catch(t){console.warn(t)}}},{key:"render",value:function(){return this.state.selectedUser?this.state.messageLoading?r.a.createElement(K,null):this.renderChatUI():this.renderNoUserSelectedUI()}}],[{key:"getDerivedStateFromProps",value:function(e,t){return null===t.selectedUser||t.selectedUser._id!==e.selectedUser._id?{selectedUser:e.selectedUser,messageLoading:!0,page:null,messages:[]}:null}}]),n}(r.a.Component),ne=function(e){var t=e.message,n=e.isAuth;return r.a.createElement("div",{className:"chat-row ".concat("admin"===t.username?"admin":n?"auth":"")},"admin"===t.username||n?"":r.a.createElement("div",{className:"chat-auth"},t.username),r.a.createElement("div",{className:"chat-item"},W.a.emojify(t.text)))},ae=Object(v.b)((function(e){return{userId:e.auth.userId,token:e.auth.token}}))(te),re=n(21),se=n.n(re),oe=(n(116),function(e){var t=e.err,n=e.onAction;return r.a.createElement("div",{className:"error-fullpage",onClick:n||null},r.a.createElement("div",{className:"error"},t),r.a.createElement("small",null,"Click to refresh"))}),ce=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).createSocketConnection=function(){var e=a.props.userId;if(e)try{k.createSocketConnection(e),a.setState({isLoading:!1}),k.receiveTypingMessage(),k.eventEmitter.on("typing-message-response",a.addTypingUser)}catch(t){a.setState({isLoading:!1,error:t.message})}},a.handleViewPortResize=function(){window.innerWidth>1200?(a.setState({isMobileViewPort:!1}),window.removeEventListener("click",a.handleCloseSidebar)):(a.setState({isMobileViewPort:!0,toggleValue:!0}),window.addEventListener("click",a.handleCloseSidebar))},a.switchToggleValue=function(){var e=!a.state.toggleValue;a.setState({toggleValue:e}),e?window.setTimeout((function(){return window.addEventListener("click",a.handleCloseSidebar)}),500):window.removeEventListener("click",a.handleCloseSidebar)},a.handleCloseSidebar=function(e){a.sidebarElem&&a.sidebarElem.current&&(!a.sidebarElem.current.contains(e.target)&&a.state.toggleValue&&a.switchToggleValue(),window.removeEventListener("click",a.handleCloseSidebar))},a.updateSelectedUser=function(e){a.setState({selectedUser:e}),a.switchToggleValue()},a.addTypingUser=function(e){var t=e.userId;a.state.typing[t]&&window.clearTimeout(a.state.typing[t]);var n=a.state.typing;n[t]=window.setTimeout((function(){return a.typingTimeout(t)}),3e3),a.setState({typing:n})},a.renderNoUserSelectedUI=function(){return r.a.createElement("div",{className:"no-chat-select-bx"},r.a.createElement("img",{src:Y.a,alt:""}),r.a.createElement("h4",null,"Select a Chat"))},a.sidebarElem=r.a.createRef(),a.state={isMobileViewPort:!1,toggleValue:!1,isLoading:!0,selectedUser:null,error:null,typing:{}},a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){this.handleViewPortResize(),window.addEventListener("DOMContentLoaded onLoad",this.handleViewPortResize),window.addEventListener("resize",this.handleViewPortResize),this.createSocketConnection()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("DOMContentLoaded",this.handleViewPortResize),window.removeEventListener("resize",this.handleViewPortResize),window.removeEventListener("click",this.handleCloseSidebar)}},{key:"componentDidUpdate",value:function(e){null!==e.userId&&e.userId===this.props.userId||this.createSocketConnection()}},{key:"typingTimeout",value:function(e){if(this.state.typing[e]){window.clearTimeout(this.state.typing[e]);var t=this.state.typing;t[e]=null,this.setState({typing:t})}}},{key:"render",value:function(){var e=this;if(this.props.error||this.state.error){var t=g.getAuthValue(),n=t.userId,a=t.token,s={onAction:function(){return e.props.error?e.props.checkUserToken(n,a):e.createSocketConnection()}};return r.a.createElement(oe,Object.assign({err:this.props.error},s))}if(this.state.isLoading||this.props.isLoading)return r.a.createElement("div",{style:{height:"100vh"}},r.a.createElement(K,null));var o={isMobileViewPort:this.state.isMobileViewPort,toggleValue:this.state.toggleValue,switchToggle:this.switchToggleValue};return r.a.createElement("main",{className:"home-page"},r.a.createElement(V,Object.assign({sidebarRef:this.sidebarElem,typing:this.state.typing,updateSelectedUser:this.updateSelectedUser},o)),r.a.createElement("div",{className:"chat-pane"},r.a.createElement("div",{className:"top-bar"},o.isMobileViewPort?r.a.createElement("span",{className:"toggle-bar",onClick:o.switchToggle},U):r.a.createElement(r.a.Fragment,null),r.a.createElement("div",null,r.a.createElement("span",null,this.state.selectedUser?this.state.selectedUser.username:r.a.createElement("span",{className:"logo-kit"},r.a.createElement("img",{src:se.a,alt:"logo"}),r.a.createElement("span",null,"YouChat"))))),this.state.selectedUser?r.a.createElement(ae,Object.assign({selectedUser:this.state.selectedUser,typing:this.state.typing},o)):this.renderNoUserSelectedUI()))}}]),n}(r.a.Component),ie=Object(v.b)((function(e){var t=e.auth;return{userId:t.userId,token:t.token,error:t.error,isLoading:t.isLoading}}),(function(e){return{checkUserToken:function(t,n){return e(B.checkToken(t,n))}}}))(ce),le=(n(117),function(){var e=Object(a.useState)(""),t=Object(L.a)(e,2),n=t[0],s=t[1],o=Object(a.useState)(""),c=Object(L.a)(o,2),i=c[0],l=c[1],u=Object(a.useState)(!1),m=Object(L.a)(u,2),d=m[0],g=m[1];return d?r.a.createElement(h.a,{to:"/chat?name=".concat(n,"&room=").concat(i)}):r.a.createElement("div",{id:"join-bx"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),i.trim().length>0&&n.trim().length>0&&g(!0)}},r.a.createElement("h2",null,"Join A Server ",r.a.createElement("span",{role:"img","aria-label":"rocket"},"\ud83d\ude80")),r.a.createElement("input",{placeholder:"Your Name",type:"name",onChange:function(e){return s(e.target.value)}}),r.a.createElement("input",{placeholder:"Room Name",type:"room",onChange:function(e){return l(e.target.value)}}),r.a.createElement("div",null,r.a.createElement("button",{type:"submit",disabled:!(i.trim().length>0&&n.trim().length>0)},"Join"))))}),ue=r.a.createContext(),me=ue.Consumer,he=ue.Provider,de=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).USER_THEME_PREFERENCE="USER_THEME_PREFERENCE",e.state={theme:"night"},e.toggleTheme=function(){e.setState((function(t){var n="day"===t.theme?"night":"day";return window.localStorage.setItem(e.USER_THEME_PREFERENCE,n),{theme:n}}))},e}return Object(i.a)(n,[{key:"render",value:function(){return r.a.createElement(he,{value:this.state.theme},this.props.children)}}]),n}(a.Component);de.getDerivedStateFromProps=function(){var e=window.localStorage.getItem(de.USER_THEME_PREFERENCE);return e?{theme:e}:(window.localStorage.setItem(de.USER_THEME_PREFERENCE,"night"),null)};var ge={Provider:de,Consumer:me},pe=(n(59),function(e){var t=Object(a.useState)(""),n=Object(L.a)(t,2),s=n[0],o=n[1],c=Object(a.useState)(""),i=Object(L.a)(c,2),l=i[0],u=i[1],d=Object(v.c)(),p=Object(v.d)((function(e){return e.auth})),f=p.error,E=p.isLoading,b=p.token,C=p.userId,w=function(e){e.preventDefault(),d(B.loginUser({username:s,password:l}))},k=(e.location.state||{from:{pathname:"/"}}).from;return b?(g.authenticate(C,b,(function(){return r.a.createElement(h.a,{to:k.pathname})})),r.a.createElement(h.a,{to:k.pathname})):r.a.createElement(ge.Consumer,null,(function(t){return r.a.createElement("main",{className:"".concat(t," form-page")},r.a.createElement("form",{onSubmit:w},r.a.createElement("h2",null," ",r.a.createElement("img",{src:se.a,alt:"logo"}),"   YouChat "),r.a.createElement("h3",null,e.location.state?"Yeah! You have to login":"Welcome Back!"," ",r.a.createElement("span",{role:"img","aria-label":"cool"},"\ud83d\ude0e")),r.a.createElement("input",{placeholder:"Your Username",value:s,type:"name",onChange:function(e){return o(e.target.value)}}),r.a.createElement("input",{placeholder:"Password",value:l,type:"password",onChange:function(e){return u(e.target.value)}}),f?r.a.createElement("div",{className:"error"},f):"",r.a.createElement("div",null,r.a.createElement("button",{type:"submit",disabled:!(l.trim().length>0&&s.trim().length>0)},"Login",E?r.a.createElement(A,null):"")),r.a.createElement("div",{className:"redirect"},"You don't have an account?",r.a.createElement(m.b,{to:"/signup"},"Sign Up"))))}))}),fe=function(e){var t=Object(a.useState)(""),n=Object(L.a)(t,2),s=n[0],o=n[1],c=Object(a.useState)(""),i=Object(L.a)(c,2),l=i[0],u=i[1],d=Object(a.useState)(""),p=Object(L.a)(d,2),f=p[0],E=p[1],b=Object(v.c)(),C=Object(v.d)((function(e){return e.auth})),w=C.error,k=C.userId,O=C.isLoading,S=C.token,y=function(e){e.preventDefault(),b(B.signupUser({username:s,email:l,password:f}))},U=(e.location.state||{from:{pathname:"/"}}).from;return S?(g.authenticate(k,S,(function(){return r.a.createElement(h.a,{to:U.pathname})})),r.a.createElement(h.a,{to:U.pathname})):r.a.createElement(ge.Consumer,null,(function(e){return r.a.createElement("main",{className:"".concat(e," form-page")},r.a.createElement("form",{onSubmit:y},r.a.createElement("h2",null," ",r.a.createElement("img",{src:se.a,alt:"logo"}),"   YouChat "),r.a.createElement("h3",null," Join and Start a Conversation ",r.a.createElement("span",{role:"img","aria-label":"rocket"},"\ud83d\ude80")),r.a.createElement("input",{placeholder:"Your Username",value:s,type:"name",onChange:function(e){return o(e.target.value)}}),r.a.createElement("input",{placeholder:"Your Email",value:l,type:"email",onChange:function(e){return u(e.target.value)}}),r.a.createElement("input",{placeholder:"Password",value:f,type:"password",onChange:function(e){return E(e.target.value)}}),r.a.createElement("div",{className:"error"},w||""),r.a.createElement("div",null,r.a.createElement("button",{type:"submit",disabled:!(f.trim().length>0&&s.trim().length>0)},"Create",O?r.a.createElement(A,null):"")),r.a.createElement("div",{className:"redirect"},r.a.createElement(m.b,{to:"/login"},"Login"),", If you have an account")))}))},Ee=(n(118),function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"notfound-top"},r.a.createElement("span",{onClick:function(){return window.history.back()}},"Go Back")),r.a.createElement("main",{className:"notfound-bx"},r.a.createElement("span",null,"4"),r.a.createElement("span",null,"0"),r.a.createElement("span",null,"4")))}),ve=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(i.a)(n,[{key:"componentDidMount",value:function(){if(g.isAuthenticated()){var e=g.getAuthValue(),t=e.userId,n=e.token;this.props.checkUserToken(t,n)}}},{key:"render",value:function(){return r.a.createElement(ge.Consumer,null,(function(e){return r.a.createElement("div",{className:"app-body ".concat(e)},r.a.createElement(m.a,null,r.a.createElement(h.d,null,r.a.createElement(h.b,{path:"/",exact:!0},r.a.createElement(h.a,{to:"/chat"})),r.a.createElement(p,{path:"/chat",component:ie}),r.a.createElement(h.b,{path:"/join",component:le}),r.a.createElement(f,{path:"/login",component:pe}),r.a.createElement(f,{path:"/signup",component:fe}),r.a.createElement(h.b,{path:"*",component:Ee}))))}))}}]),n}(a.Component),be=Object(v.b)((function(e){return{userId:e.auth.userId,token:e.auth.token}}),(function(e){return{checkUserToken:function(t,n){return e(B.checkToken(t,n))}}}))(ve);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Ce={token:null,error:null,userId:null,isLoading:!1},we=n(22),ke=n(66),Oe=Object(we.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ce,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"login_user_pending":return Object(T.a)(Object(T.a)({},e),{},{isLoading:!0,error:null});case"login_user_success":return Object(T.a)(Object(T.a)({},e),{},{token:a.token,isLoading:!1,userId:a.userId,error:null});case"login_user_failed":return Object(T.a)(Object(T.a)({},e),{},{token:null,isLoading:!1,userId:null,error:a.error});case"logout_user_pending":return Object(T.a)(Object(T.a)({},e),{},{isLoading:!0,error:null});case"logout_user_success":return Object(T.a)(Object(T.a)({},e),{},{token:null,isLoading:!1,userId:null,error:null});case"logout_user_failed":return Object(T.a)(Object(T.a)({},e),{},{token:null,isLoading:!1,userId:null,error:a.error});default:return e}}}),Se=Object(we.d)(Oe,Object(we.a)(ke.a));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(v.a,{store:Se},r.a.createElement(ge.Provider,{value:"day"},r.a.createElement(be,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},21:function(e,t,n){e.exports=n.p+"static/media/logo.e60f0d19.svg"},33:function(e,t,n){e.exports=n.p+"static/media/choiceSelect.4b22275f.svg"},58:function(e,t,n){},59:function(e,t,n){},62:function(e,t,n){e.exports=n.p+"static/media/startConversation.d2c64057.svg"},65:function(e,t,n){e.exports=n.p+"static/media/doneforyou.8a8b917c.mp3"},67:function(e,t,n){e.exports=n(119)},72:function(e,t,n){},73:function(e,t,n){}},[[67,1,2]]]);
//# sourceMappingURL=main.d5e29900.chunk.js.map